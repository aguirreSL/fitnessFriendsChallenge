{% extends 'fitness/base.html' %}
{% load custom_filters %}

{% block title %}Challenge Detail{% endblock %}

{% block content %}
<div class="container mt-5">
    <h2 class="text-center mb-4">{{ challenge.name }} (<a href="{% url 'edit_challenge' challenge.id %}" class="text-decoration-none">Edit</a>)</h2>
    <p><strong>Description:</strong> {{ challenge.description }}</p>
    <p><strong>Type:</strong> {{ challenge.get_challenge_type_display }}</p>
    <p><strong>Group:</strong> {{ challenge.fitness_group.name }}</p>
    <p><strong>Target Amount:</strong> {{ challenge.target_amount }} {{ challenge.get_challenge_type_display }}</p>
    <p><strong>Start Date:</strong> {{ challenge.start_date }}</p>
    <p><strong>End Date:</strong> {{ challenge.end_date }}</p>
    
    <h3>Participants</h3>
    <table class="table table-striped table-bordered" style="color: #000;">
        <thead class="custom-thead">
            <tr>
                <th>User</th>
                <th>Week {{ challenge.get_challenge_type_display }}</th>
                <th>Current Total {{ challenge.get_challenge_type_display }}</th>
                <th>Consecutive Activities Log Days</th>
                <th>Current Month Stars ({{ now|date:"F" }} Stars)</th>
            </tr>
        </thead>
        <tbody>
            {% for participant in participants_data %}
                <tr>
                    <td>{{ participant.username }}</td>
                    <td>{{ participant.week_challenge_type_display }}</td>
                    <td>{{ participant.current_total_challenge_type_display }}</td>
                    <td>{{ participant.consecutive_activities_log_days }}</td>
                    <td>{{ participant.current_month_stars|stars }}</td>
                </tr>
            {% empty %}
                <tr>
                    <td colspan="5" class="text-center">No participants yet.</td>
                </tr>
            {% endfor %}
        </tbody>
    </table>
    
    <h3>Challenge Overview</h3>
    <table class="table table-striped table-bordered" style="color: #000;">
        <thead class="custom-thead">
            <tr>
                <th>User</th>
                <th>Jan</th>
                <th>Feb</th>
                <th>Mar</th>
                <th>Apr</th>
                <th>May</th>
                <th>Jun</th>
                <th>Jul</th>
                <th>Aug</th>
                <th>Sep</th>
                <th>Oct</th>
                <th>Nov</th>
                <th>Dec</th>
                <th>Total</th>
            </tr>
        </thead>
        <tbody>
            {% for participant in participants_data %}
                <tr>
                    <td>{{ participant.username }}</td>
                    <td>{{ participant.1_stars|stars }}</td>
                    <td>{{ participant.2_stars|stars }}</td>
                    <td>{{ participant.3_stars|stars }}</td>
                    <td>{{ participant.4_stars|stars }}</td>
                    <td>{{ participant.5_stars|stars }}</td>
                    <td>{{ participant.6_stars|stars }}</td>
                    <td>{{ participant.7_stars|stars }}</td>
                    <td>{{ participant.8_stars|stars }}</td>
                    <td>{{ participant.9_stars|stars }}</td>
                    <td>{{ participant.10_stars|stars }}</td>
                    <td>{{ participant.11_stars|stars }}</td>
                    <td>{{ participant.12_stars|stars }}</td>
                    <td>{{ participant.total_stars }}</td>
                </tr>
            {% empty %}
                <tr>
                    <td colspan="14" class="text-center">No participants yet.</td>
                </tr>
            {% endfor %}
        </tbody>
    </table>
    
    {% if user in challenge.fitness_group.admins.all %}
        <a href="{% url 'delete_challenge' challenge_id=challenge.id %}">Delete Challenge</a>
    {% endif %}
</div>
{% endblock %}